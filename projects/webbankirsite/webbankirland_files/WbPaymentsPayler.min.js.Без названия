$(document).on("load keyup","input",function(e){if(e.which!==13&&this.id){if($("#"+this.id).val()){$("#"+this.id).addClass("filled")}else{if(this.id){$("#"+this.id).removeClass("filled")}}}});function preloaderButton(action,text,color){if(action==="start"){$(".payment-form button").html('<div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div>').prop("disabled",true).css("background-color","#e0e0e0")}else{$(".payment-form button").html(text).prop("disabled",false).css("background-color",color)}}$(document).on("submit",".payment-form",function(e){e.preventDefault();var url=$(this).data("ajax-payment");var actionStep=$(this).data("action-step");var color=$(".payment-form button").css("background-color");preloaderButton("start",false,false);$.ajax({type:"POST",url:url,data:{id:$(this).data("payment-id"),login:$("#login").val(),action:actionStep},cache:false}).done(function(res){if(res.data.result===false){$(".error_payment").css("display","block");$(".error_payment span").html(res.data.message);$("#login").parent("div").addClass("error");preloaderButton("stop","Оплатить",color);return false}$(".instant_content").html(res.data);$("html, body").animate({scrollTop:$(".instant-pay").offset().top},300)}).fail(function(){alert("Ошибка выполнения запроса!");preloaderButton("stop","Оплатить",color)})});$(document).on("keyup","#sum_total",function(){$(".error_payment").css("display","none");$("#sum_total").parent("div").removeClass("error")});$(document).on("keyup","#login2",function(){var oneChar=$(this).val().substr(0,1);if(oneChar<7){$(this).mask("0000000000");if($(this).val().length>=9){$(".payment-form button").attr("disabled",false)}else{$(".payment-form button").attr("disabled",true)}}if(oneChar=="7"||oneChar=="8"||oneChar=="9"){if($(this).val().length==1){switch(oneChar){case"7":case"8":$(this).mask("0 (000) 000-00-00");break;case"9":$(this).mask("8 (900) 000-00-00");var formVal=$(this).val();$(this).val("").focus().val(formVal);break}}if($(this).val().replace(/^\.|[^\d\.]|\.(?=.*\.)|^0+(?=\d)/g,"").length==11){$(".payment-form button").attr("disabled",false)}else{$(".payment-form button").attr("disabled",true)}}$(".error_payment").css("display","none");$("#login").parent("div").removeClass("error")});$(document).on("click",".payment-button",function(e){e.preventDefault();var id=$(".payment-form-info").data("payment-id");var url=$(".payment-form-info").data("ajax-payment");var login=$(".payment-form-info").data("login");$.ajax({type:"POST",url:url,data:{id:id,login:login,sum_total:$("#sum_total").val(),action:"payment"},cache:false}).done(function(res){if(res.response=="fail"){$(".error_payment").css("display","block");$(".error_payment span").html(res.error);$("#sum_total").parent("div").addClass("error");return false}if(res.data.result==false){$(".error_payment").css("display","block");$(".error_payment span").html(res.data.message);$("#sum_total").parent("div").addClass("error");return false}$(".instant-pay").html("");createFrame(res.data.payments_link)}).fail(function(){alert("Ошибка выполнения запроса!")})});function createFrame(src_redir){var iframe=document.createElement("iframe");iframe.id="pay_iframe";iframe.name="pay_iframe";iframe.src=src_redir;if(viewport().width<712){iframe.style.width="100%"}else{iframe.style.width="100%"}iframe.style.height="780px";$(window).resize(function(){if(viewport().width<712){iframe.style.width="100%";iframe.style.height="900px"}else{iframe.style.width="100%";iframe.style.height="780px"}});document.getElementsByClassName("instant-pay")[0].appendChild(iframe);document.getElementById("pay_iframe").style.borderWidth=0;document.getElementById("pay_iframe").style.scrolling="no";document.getElementById("pay_iframe").style.overflow="hidden";var isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;var _padd=isSafari==true?150:80;window.addEventListener("message",function(e){if(e.data&&e.data.indexOf("{")>=0){var d=JSON.parse(e.data);if(d.height){iframe.style.height=d.height+_padd+"px"}if(d.close){if(d.close=="res_true"){$("#sum").val("0.00")}$("#pay_iframe").remove();$("#sum_block").removeClass("hidden");$("#paylerButton").removeClass("hidden")}}},false)}function viewport(){var e=window,a="inner";if(!("innerWidth"in window)){a="client";e=document.documentElement||document.body}return{width:e[a+"Width"],height:e[a+"Height"]}}function backPayment(val,url){if(!val||!url){return false}$.ajax({type:"POST",url:url,data:{load_block:val},cache:false}).done(function(res){$(".instant_content").html(res)}).fail(function(){alert("Ошибка выполнения запроса!")})}function listener(e){if(e.data){if(typeof e.data==="string"){if(e.data.indexOf("{")>=0){var d=JSON.parse(e.data);if(d.heightFrame){$("#pay_iframe").css("height",d.heightFrame+70)}}}}}if(window.addEventListener){window.addEventListener("message",listener)}else{window.attachEvent("onmessage",listener)}